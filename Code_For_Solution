# VI. CODE FOR THE SOLUTION

#include <WiFi.h>
#include <HTTPClient.h>

// WiFi details
const char* ssid = "YOUR_WIFI_NAME";  // WiFi connection name
const char* password = "YOUR_WIFI_PASSWORD";  // WiFi password

// ThingSpeak details
String apiKey = "YOUR_API_KEY";  // API Key
const char* server = "http://api.thingspeak.com/update";

// Pin definitions
const int flamePin = 15;     // Flame sensor DO
const int smokePin = 26;     // Smoke sensor AO
const int buzzer = 5;        // Buzzer pin

void setup() {
  Serial.begin(115200);

  pinMode(flamePin, INPUT);
  pinMode(buzzer, OUTPUT);

  Serial.println("Connecting to WiFi...");
  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(300);
    Serial.print(".");
  }

  Serial.println("\nWiFi Connected!");
}

void loop() {

  // Read sensor data
  int flameValue = digitalRead(flamePin);   // 1 = flame detected
  int smokeValue = analogRead(smokePin);    // Higher value = more smoke

  bool flameDetected = (flameValue == 1);
  bool smokeDetected = (smokeValue > 800);   // Threshold for smoke 


   //       PRINT STATUS
  Serial.print("Flame: ");
  Serial.print(flameDetected ? "DETECTED" : "NO FLAME");

  Serial.print(" | Smoke: ");
  Serial.print(smokeDetected ? "DETECTED" : "NO SMOKE");

  Serial.print(" | Smoke Value: ");
  Serial.println(smokeValue);

 
   //       ALERT LOGIC
  if (flameDetected && smokeDetected) {
    Serial.println("‚ö†Ô∏è WARNING: FIRE + SMOKE DETECTED!");
    digitalWrite(buzzer, LOW);
  }
  else if (flameDetected && !smokeDetected) {
    Serial.println("üî• ALERT: FLAME DETECTED!");
    digitalWrite(buzzer, LOW);
  }
  else if (!flameDetected && smokeDetected) {
    Serial.println("üí® ALERT: SMOKE DETECTED!");
    digitalWrite(buzzer, LOW);
  }
  else {
    Serial.println("System Normal!!!");
    digitalWrite(buzzer, HIGH);
  }

  Serial.println("----------------------------------------");

 
  //     SEND TO THINGSPEAK
  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;

    String url = String(server)
                 + "?api_key=" + apiKey
                 + "&field1=" + String(flameDetected)
                 + "&field2=" + String(smokeValue)
                 + "&field3=" + String(smokeDetected)
                 + "&field4=" + String(flameDetected && smokeDetected);

    http.begin(url);
    int code = http.GET();
    http.end();

    Serial.print("ThingSpeak Response: ");
    Serial.println(code);
  }

  delay(15000);  // 15 sec delay (ThingSpeak rule)
}

